@page "/{eventId}/{eventRole}/Teams/{teamId}/Hints/{puzzleId}"
@model ServerCore.Pages.Teams.HintsModel

<style>
    button:disabled {
        color: #aaaaaa;
    }

    /*
     * Strikeout style for hints
     */
    .strike1 {
        position: relative;
    }
    .strike1:before {
        color: red;
        position: absolute;
        content: "";
        left: 0;
        top: 50%;
        right: 0;
        border-top: 1px solid;
        border-color: inherit;
        -webkit-transform: rotate(-35deg);
        -moz-transform: rotate(-35deg);
        -ms-transform: rotate(-35deg);
        -o-transform: rotate(-35deg);
        transform: rotate(-35deg);
    }
    .strike2:after {
        color: red;
        position: absolute;
        content: "";
        left: 0;
        top: 50%;
        right: 0;
        border-top: 1px solid;
        border-color: inherit;
        -webkit-transform: rotate(35deg);
        -moz-transform: rotate(35deg);
        -ms-transform: rotate(35deg);
        -o-transform: rotate(35deg);
        transform: rotate(35deg);
    }
</style>
@{
    ViewData["Title"] = "Hints";
    ViewData["AdminRoute"] = "/Puzzles/Index";
    ViewData["AuthorRoute"] = "/Puzzles/Index";
    //Needs route data - ViewData["PlayRoute"] = "/Teams/Hints";
}

<h2>Hints for @Model.PuzzleName</h2>

<div>
    <a asp-page="/Teams/Play">Back to puzzle list</a>
</div>

You have <b>
    @if (Model.Team.HintCoinCount > 0)
    {
        @Model.Team.HintCoinCount
    }
    else
    {
        <text>no</text>
    }
</b> hint tickets.

<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Hints[0].Hint.Description)
            </th>
            <th>
                <text>Hint</text>
            </th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @{int discount = Model.Hints.Count == 0 ? 0
                      : Model.Hints.Min(hws => (hws.IsUnlocked && hws.Hint.Cost < 0) ? hws.Hint.Cost : 0); }
        @foreach (var hint in Model.Hints)
        {
            int baseCost = Math.Abs(hint.Hint.Cost);
            int adjustedCost = Math.Max(0, baseCost + discount);
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => hint.Hint.Description)
                </td>
                <td>
                    @if (hint.IsUnlocked)
                    {
                        @Html.DisplayFor(modelItem => hint.Hint.Content)
                    }
                    else
                    {
                        <b>Cost:</b>
                        if (discount != 0)
                        {
                            <span class="strike1 strike2">&nbsp;@baseCost&nbsp;</span>
                        }
                        if (adjustedCost == 0)
                        {
                            <text>FREE</text>
                        }
                        else
                        {
                            @adjustedCost
                        }
                    }

                    @if (!hint.IsUnlocked)
                    {
                        <form method="post" style="display:inline-block">
                            @if (Model.Team.HintCoinCount >= adjustedCost)
                            {
                                <button type="submit" asp-route-hintId="@hint.Hint.Id" 
                                    asp-route-teamId="@Model.Team.ID" 
                                    asp-route-puzzleId="@Model.PuzzleID" 
                                    asp-page-handler="Unlock" 
                                    onclick="return confirm('Are you sure you want to spend @adjustedCost tickets to find out &quot;@hint.Hint.Description&quot;?')" 
                                    style="margin-left: 5px; margin-right: 5px;">Unlock</button>
                            }
                            else
                            {
                                <button type="submit" disabled 
                                    style="margin-left: 5px; margin-right: 5px;">Unlock</button>
                                if (adjustedCost - Model.Team.HintCoinCount == 1)
                                {
                                    <text>You need 1 more ticket to unlock.</text>
                                }
                                else
                                {
                                    <text>You need @(adjustedCost - Model.Team.HintCoinCount) more tickets to unlock.</text>
                                }
                            }
                        </form>
                    }
                </td>
                <td></td>
            </tr>
        }
    </tbody>
</table>
